---
title: Cheerio을 이용한 데이터 수집
date: 2024-01-29 00:00:00 +0900
categories: [JavaScript]
tags: [javascript, cheerio]
--- 
- 이번 포스터에서는 `cheerio`을 이용하여 `Node.js` 환경에서 데이터를 수집하는 방법을 학습하고자 한다.

## 1. Cheerio란?
- `Cheerio`는 HTML/XML을 파싱하고 쉽게 조작할 수 있는 JS 라이브러리이다.
- 보통은 `open api`을 활용해서 데이터를 수집하지만, 때로는 `crawling`을 통해 데이터를 수집해야 될 필요성이 있다.

## 2. Cheerio을 시작하기
- `Node.js` 환경에서 터미널을 이용해서 `cheerio`을 설치해 준다.
```ssh
npm install cheerio
```
- `Javascript` 코드에서 `import 문`을 사용해서 가져와 준다.
```js
import * as cheerio from 'cheerio';
```

## 3. 데이터 수집

### 3.1. Axios을 이용
- 통신 라이브러리인 `Axios`을 사용해서 관련 url을 통해 데이터를 가져와서 HTML을 로딩해준다.

  ```js
  const resp = await axios.get('수집하고자 하는 url');
  const $ = cheerio.load(resp.data)

  // HTML 추출해서 출력해준다.
  console.log($.html());
  ```

### 3.2. Css 선택자로 선택
- 로딩된 HTML에서 특정 정보를 추출하기 위해서 `css 선택자`를 이용하는 것이 편리한 것 같다.(내 생각...)
- `Css 선택자`에 대해서 간단히만 살펴보고 넘어가고자 한다. 아래 내용을 조합해서 사용하게 된다.

  ```css
  <!-- tag 찾기 -->
  tag_이름

  <!-- id로 찾기 -->
  #id_이름
  
  <!-- class로 찾기 -->
  .class_이름

  <!-- tag 중에서 특정 class만 선택 -->
  tag_이름.class_이름

  <!-- class가 여러 개일 경우 -->
  .class_이름1.class_이름2

  <!-- 공백을 이용 -->
  <!-- tag의 자손 중에서 class를 선택 -->
  tag_이름 .class_이름

  <!-- '>'을 이용 -->
  <!-- tag의 자식 중에서 class를 선택 -->
  tag_이름 > .class_이름
  ```

- HTMl을 로딩한 [$](#31-axios을-이용)을 css 선택자로 선택하는 예를 아래와 같다.
```js
const $css_선택자 = $('css_선택자')
```

### 3.3. 내용 추출
- 보통 데이터를 crawling할 때, `url` 또는 `text`을 많이 추출한다.(내 생각...)
- `url`은 보통 `a` 태그의 `href` 속성에 있는 경우가 많다.
```js
console.log($('a').prop('href'))
```
  - 굳이 `href` 속성이 아니더라도 다른 속성에 있는 데이터도 `.prop`을 통해서 가져올 수 있다.
- 'text'을 추출하는 방법은 간단한다.
```js
console.log($('p').text())
```

## 4. 주의해야 될 사항

### 4.1. css 선택자 이용
- 보통 css 선택자를 이용하려고 할 때, 해당 `웹 사이트` > `개발자 도구` > `요소`에서 확인을 하는 경우가 많다.
- 하지만 `요소`에 나오는 코드는 `서버로부터 전달받은 코드`가 아니라 `서버에서 전달받은 코드를 자바스크립트 등을 실행해 변환된 코드`이다.
- 따라서 `개발자 도구` > `네트워크` > `해당 파일` > `응답`에서 확인하는 것이 가장 정확하다.

### 4.2. 개발자 도구의 네트워크 활용
- 가끔씩은 `개발자 도구` > `네트워크` > `해당 파일` > `응답`을 통해서도 확인해봐도 원하는 데이터가 없는 경우가 존재한다.
- 이 경우는 대부분 해당 url에 데이터가 존재하지 않고 다른 파일에 존재하는 데이터를 가져와 사용한다.
- `개발자 도구` > `네트워크`을 띄워준 채로 새로고침을 눌러서 나오는 파일들을 하나하나 확인해 보면서 `응답`에 원하는 데이터가 있는지 확인한다.(파일이 많은 것 같지만 막상 해 보면 얼마 걸리지 않는다.)
- 해당 파일의 `헤더`를 확인해서 `요청 URL`과 `요청 메서드`을 맞춰서 데이터를 가져온다.
- 위의 방법으로 해결이 되는 경우도 있지만 그렇지 않고 error을 반환하는 경우도 존재한다.
- 이럴 경우에는 `헤더` > `요청 헤더`에 있는 내용들을 같이 넣어서 전송해 주면 데이터 가져올 수 있다.
```js
const resp = await axios.get('수집하고자 하는 url',{
    headers : {
        "Accept" : "~~~",
        ~~~~
    }
});
```

## 마치며
- `cheerio`을 이용해서 데이터 수집하는 방법을 알아봤는데 무엇보다 가장 좋은 방법은 관심이 있는 사이트를 직접 crawling하는 것이 제일 좋은 방법인 것 같다.
- 데이터를 요청하고 응답하는 과정에서 변하지 않은 진실은 `데이터를 요청하는 방식이 같으면 응답되는 데이터도 항상 같다`이다.

## 참고 자료
> **[Welcome to Cheerio](https://cheerio.js.org/docs/intro)**<br/>
> **신한투자증권 프로 디지털 아카데미 3기**